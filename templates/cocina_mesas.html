{% extends "base.html" %}
{% block title %}Cocina{% endblock %}
{% block content %}
<h2>ğŸ‘¨â€ğŸ³ Panel de Cocina</h2>
<div class="alert alert-info">Tu cÃ³digo: <strong>{{ mi_codigo }}</strong></div>

<div class="row" id="orders">
  {% for o in ordenes %}
  <div class="col-md-4 mb-3">
    <div class="card">
      <div class="card-header">
        Orden #{{ o.id }} - {{ o.mesa or 'Sin mesa' }}
      </div>
      <div class="card-body">
        <ul class="list-unstyled" id="items-{{ o.id }}">
          <li class="text-muted">Cargando...</li>
        </ul>
        <button class="btn btn-success btn-sm" onclick="servir({{ o.id }})">Marcar como servida</button>
      </div>
    </div>
  </div>
  {% else %}
  <p class="text-muted">No hay Ã³rdenes pendientes.</p>
  {% endfor %}
</div>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}
{% block scripts %}
<script>
function cargarItems(orderId){
  fetch(`/api/orden/${orderId}/items`)
    .then(res => res.json())
    .then(data => {
      const ul = document.getElementById(`items-${orderId}`);
      ul.innerHTML = data.map(i => `<li><strong>${i.qty}x</strong> ${i.producto} ${i.notas ? '- ' + i.notas : ''}</li>`).join('');
    });
}
function servir(orderId){
  fetch(`/api/orden/${orderId}/servir`, {method: 'POST'})
    .then(() => location.reload());
}
document.querySelectorAll('[id^="items-"]').forEach(el => {
  const orderId = el.id.split('-')[1];
  cargarItems(orderId);
});
</script>
{% endblock %}